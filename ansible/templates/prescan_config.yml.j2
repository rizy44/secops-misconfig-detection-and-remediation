# Pre-Scan Node Configuration
# Generated by Ansible
# =============================

# General settings
node:
  name: {{ prescan_node_name | default('prescan-node') }}
  log_level: {{ log_level | default('INFO') }}
  log_file: /var/log/prescan/prescan.log

# File Watcher settings
watcher:
  watch_dir: {{ deploy_input_dir | default('/deploy/in') }}
  poll_interval: {{ poll_interval | default(5) }}
  patterns:
    terraform:
      - "*.tf"
      - "*.tfvars"
    ansible:
      - "*.yml"
      - "*.yaml"
      - "playbook*.yml"
  ignore:
    - ".git/**"
    - "__pycache__/**"
    - "*.pyc"
    - ".terraform/**"

# Scanner settings
scanners:
  enabled:
{% for scanner in enabled_scanners | default(['checkov', 'trivy', 'ansible-lint', 'yamllint']) %}
    - {{ scanner }}
{% endfor %}
  
  checkov:
    severity: 
      - HIGH
      - CRITICAL
    skip_checks: []
    
  trivy:
    severity:
      - HIGH
      - CRITICAL
    exit_code: 1
    
  ansible_lint:
    profile: production
    strict: false
    
  yamllint:
    config_file: /app/config/.yamllint

# Auto-Fix Engine settings
auto_fix:
  enabled: {{ auto_fix_enabled | default(true) }}
  runbook_catalog: /app/runbooks/catalog.yml
  max_attempts: {{ max_fix_attempts | default(3) }}
  require_approval:
{% for item in require_approval | default(['security_group_changes', 'network_changes']) %}
    - {{ item }}
{% endfor %}
  auto_approve:
{% for item in auto_approve | default(['yaml_formatting', 'missing_tags']) %}
    - {{ item }}
{% endfor %}

# Deployment settings
deploy:
  enabled: {{ deploy_enabled | default(true) }}
  output_dir: {{ deploy_output_dir | default('/deploy/out') }}
  
  terraform:
    enabled: {{ terraform_deploy_enabled | default(true) }}
    auto_apply: {{ terraform_auto_apply | default(false) }}
    plan_only: {{ terraform_plan_only | default(true) }}
    
  ansible:
    enabled: {{ ansible_deploy_enabled | default(true) }}
    inventory: /etc/ansible/hosts
    become: true
    
  verify:
    enabled: {{ verify_enabled | default(true) }}
    timeout: {{ verify_timeout | default(300) }}

# Notification settings
notifications:
  enabled: {{ notifications_enabled | default(true) }}
  channels:
    webhook:
      enabled: {{ webhook_enabled | default(false) }}
      url: "{{ webhook_url | default('') }}"
    log:
      enabled: true
  events:
    - scan_started
    - scan_completed
    - finding_detected
    - fix_applied
    - deploy_started
    - deploy_completed
    - deploy_failed

# API Server settings
api:
  host: 0.0.0.0
  port: {{ prescan_api_port | default(8001) }}
  workers: {{ api_workers | default(2) }}

# Database settings
database:
  type: sqlite
  path: /data/prescan/prescan.db

# Integration with SecOps App
secops_integration:
  enabled: {{ secops_integration_enabled | default(true) }}
  secops_api_url: "http://{{ secops_app_ip }}:8000"
  sync_findings: {{ sync_findings | default(true) }}
  sync_interval: {{ sync_interval | default(60) }}
